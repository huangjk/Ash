<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> 
    <title>Unity File Debug</title>
    <style type="text/css">
        html, body, div, span {
            margin: 0;
            padding: 0;
            border: 0;
            outline: 0;
            font-weight: inherit;
            font-style: inherit;
            font-size: 100%;
            font-family: Verdana, "helvetica neue", Helvetica, Arial, sans-serif;
            vertical-align: baseline;
        }
        body {
            font-size: 14px;
            line-height: 1.25;
            color: black;
            background-color: #2c3e50;
            color: #bdc3c7;
        }
        ol, ul {
            list-style: none;
            padding-left: 20px;
            font-size: 1.4em;
            line-height: 1.4em;
        }
        ul ul {
            font-size: 1em;
        }
        button {
            background: #e3e3e3;
            border: 1px solid #bbb;
            border-radius: 3px;
            -webkit-box-shadow: inset 0 0 1px 1px #f6f6f6;
            box-shadow: inset 0 0 1px 1px #f6f6f6;
            color: #333;
            font: bold 12px/1 Verdana, "helvetica neue", helvetica, arial, sans-serif;
            padding:  4px 8px;
            text-align: center;
            cursor: pointer;
        }
        button:hover {
            background: #d9d9d9;
            -webkit-box-shadow: inset 0 0 1px 1px #eaeaea;
            box-shadow: inset 0 0 1px 1px #eaeaea;
            color: #222;
        }
        button:active {
            background: #d0d0d0;
            -webkit-box-shadow: inset 0 0 1px 1px #e3e3e3;
            box-shadow: inset 0 0 1px 1px #e3e3e3;
            color: #000; 
        }
        #sidePanel{
            display: block;
            position: fixed;
            width: 20%;
            height: 100%;
            overflow: auto;
        }
        #systemInfo, #loadLog {
            margin: 0 0 10px 0;
            line-height: 1.25;
            padding: 10px;
            border-bottom: 1px solid #bdc3c7;
        }
        #large {
            padding: 0 7px;
            font-size: 125%;
        }
        #large p {
            padding: 5px;
            border: 2px solid #d62728;
            border-radius: 5px;
        }
        #systemInfo #title, 
        #systemInfo #system, 
        #systemInfo #started,
        #systemInfo #ended {
            display: block;
        }
        #search {
            display: block;
            margin: 0 auto;
            width: 90%;
            border-radius: 4px;
            padding: 5px;
        }
        #mainPanel{
            display: block;
            width: 80%;
            margin-left: 20%;
            overflow: auto;
        }
        .entry {
            margin: 5px;
            background-color: #bdc3c7;
            color: #222;
            border-radius: 2px;
        }
        .timestamp {
            padding: 5px;
            display: block;
            float: right;
        }
        .message {
            padding: 5px;
            display: block;
        }
        .stackBtn {
            margin-right: 10px;
        }
        .stack {
            display: block;
            background-color: #f0f0f0;
            padding: 10px;
            color: #2c3e50;
            border-bottom-left-radius: 2px;
            border-bottom-right-radius: 2px;
        }
        .legend {
            display: inline-block;
            width: 0.75em;
            height: 0.75em;
            margin: 0 8px;
        }
        .repo {
            display: block;
            position: fixed;
            bottom: 30px;
            left: 10px;
        }
        .repo a {
            text-decoration: none;
            color: inherit;
        }
        .issues {
            display: block;
            position: fixed;
            bottom: 10px;
            left: 10px;
        }
        .issues a {
            text-decoration: none;
            color: inherit;
        }
        .hidden {
            display: none;
        }
        .error {
            background-color: #d62728;
        }
        .exception {
            background-color: #ff9896;
        }
        .warning {
            background-color: #f1c40f;
        }
        .system {
            background-color: #17becf;
        }
        .assert {
            background-color: #ff7f0e;
        }
        .log {
            background-color: #c7c7c7;
        }
        .ai {
            background-color: #aec7e8;
        }
        .audio {
            background-color: #ffbb78;
        }
        .content {
            background-color: #2ca02c;
        }
        .logic {
            background-color: #98df8a;
        }
        .gui {
            background-color: #9467bd;
        }
        .input {
            background-color: #9edae5;
        }
        .network {
            background-color: #c49c94;
        }
        .physics {
            background-color: #e377c2;
        }
        .count {
            background-color: transparent;
            font-size: 0.7em;
        }
        .icon {
            vertical-align: middle;
            margin-right: 3px;
            width: 1em;
            height: 1em;
            display: inline-block;
        }
        #sidePanel .icon {
            fill: #bdc3c7;
        }
        #mainPanel .icon {
            fill: #222;
        }
    </style>
</head>
<body>
    <!-- from https://google.github.io/material-design-icons/ and https://octicons.github.com/ -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      
        <symbol id="assertIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M14.59 8L12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41 14.59 8zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/> 
        </symbol>
      
        <symbol id="errorIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/> 
        </symbol>

        <symbol id="exceptionIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/> 
        </symbol>

        <symbol id="warningIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/> 
        </symbol>

        <symbol id="systemIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/>
        </symbol>

        <symbol id="logIcon" viewBox="0 0 24 24">
            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
            <path d="M0 0h24v24H0z" fill="none"/> 
        </symbol>

        <symbol id="aiIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 18c0 .55.45 1 1 1h1v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h2v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h1c.55 0 1-.45 1-1V8H6v10zM3.5 8C2.67 8 2 8.67 2 9.5v7c0 .83.67 1.5 1.5 1.5S5 17.33 5 16.5v-7C5 8.67 4.33 8 3.5 8zm17 0c-.83 0-1.5.67-1.5 1.5v7c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-7c0-.83-.67-1.5-1.5-1.5zm-4.97-5.84l1.3-1.3c.2-.2.2-.51 0-.71-.2-.2-.51-.2-.71 0l-1.48 1.48C13.85 1.23 12.95 1 12 1c-.96 0-1.86.23-2.66.63L7.85.15c-.2-.2-.51-.2-.71 0-.2.2-.2.51 0 .71l1.31 1.31C6.97 3.26 6 5.01 6 7h12c0-1.99-.97-3.75-2.47-4.84zM10 5H9V4h1v1zm5 0h-1V4h1v1z"/>
        </symbol>

        <symbol id="audioIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/> 
        </symbol>

        <symbol id="contentIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
        </symbol>

        <symbol id="logicIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path d="M17 16l-4-4V8.82C14.16 8.4 15 7.3 15 6c0-1.66-1.34-3-3-3S9 4.34 9 6c0 1.3.84 2.4 2 2.82V12l-4 4H3v5h5v-3.05l4-4.2 4 4.2V21h5v-5h-4z"/>
            <path d="M0 0h24v24H0z" fill="none"/> 
        </symbol>

        <symbol id="guiIcon" viewBox="0 0 24 24">
            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
            <path d="M0 0h24v24H0z" fill="none"/>
        </symbol>

        <symbol id="inputIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M15 7.5V2H9v5.5l3 3 3-3zM7.5 9H2v6h5.5l3-3-3-3zM9 16.5V22h6v-5.5l-3-3-3 3zM16.5 9l-3 3 3 3H22V9h-5.5z"/>  
        </symbol>

        <symbol id="networkIcon" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/> 
        </symbol>

        <symbol id="physicsIcon" viewBox="0 0 24 24">
            <path d="M4.59 6.89c.7-.71 1.4-1.35 1.71-1.22.5.2 0 1.03-.3 1.52-.25.42-2.86 3.89-2.86 6.31 0 1.28.48 2.34 1.34 2.98.75.56 1.74.73 2.64.46 1.07-.31 1.95-1.4 3.06-2.77 1.21-1.49 2.83-3.44 4.08-3.44 1.63 0 1.65 1.01 1.76 1.79-3.78.64-5.38 3.67-5.38 5.37 0 1.7 1.44 3.09 3.21 3.09 1.63 0 4.29-1.33 4.69-6.1H21v-2.5h-2.47c-.15-1.65-1.09-4.2-4.03-4.2-2.25 0-4.18 1.91-4.94 2.84-.58.73-2.06 2.48-2.29 2.72-.25.3-.68.84-1.11.84-.45 0-.72-.83-.36-1.92.35-1.09 1.4-2.86 1.85-3.52.78-1.14 1.3-1.92 1.3-3.28C8.95 3.69 7.31 3 6.44 3 5.12 3 3.97 4 3.72 4.25c-.36.36-.66.66-.88.93l1.75 1.71zm9.29 11.66c-.31 0-.74-.26-.74-.72 0-.6.73-2.2 2.87-2.76-.3 2.69-1.43 3.48-2.13 3.48z"/>
            <path d="M0 0h24v24H0z" fill="none"/>
        </symbol>

        <symbol id="githubIssue"  viewBox="0 0 896 1024">
            <path d="M448 64C200.562 64 0 264.562 0 512c0 247.438 200.562 448 448 448 247.438 0 448-200.562 448-448C896 264.562 695.438 64 448 64zM448 832c-176.781 0-320-143.25-320-320 0-176.781 143.219-320 320-320 176.75 0 320 143.219 320 320C768 688.75 624.75 832 448 832zM384 768h128V640H384V768zM384 576h128V256H384V576z" />
        </symbol>

        <symbol id="githubRepo" viewBox="0 0 896 1024">
            <path d="M608 192l-96 96 224 224L512 736l96 96 288-320L608 192zM288 192L0 512l288 320 96-96L160 512l224-224L288 192z" />
        </symbol>
    </svg>

    <div id="sidePanel">
        <div id="loadLog">
            <input type="file" id="file" name="file" accept=".json" />
        </div>
        <div id="systemInfo">
            <span id="title">Load a file above</span>
            <span id="started">Started: <span id="startTime"></span></span>
            <span id="ended">Ended: <span id="endTime"></span></span>
        </div>
        <div id="query">
            <input type="search" id="search" placeholder="Search the logs">
            <ul>
                <li><label><input type="checkbox" checked="checked" id="allCheckbox">Select All</label></li>
                <li id="li-assert"><label><input type="checkbox" checked="checked" id="assertCheckbox"><span class="legend assert"></span><svg class="icon"><use xlink:href="#assertIcon" /></svg>Assert<span class="count assert"></span></label></li>
                <li id="li-error"><label><input type="checkbox" checked="checked" id="errorCheckbox"><span class="legend error"></span><svg class="icon"><use xlink:href="#errorIcon" /></svg>Error<span class="count error"></span></label></li>
                <li id="li-exception"><label><input type="checkbox" checked="checked" id="exceptionCheckbox"><span class="legend exception"></span><svg class="icon"><use xlink:href="#exceptionIcon" /></svg>Exception<span class="count exception"></span></label></li>
                <li id="li-warning"><label><input type="checkbox" checked="checked" id="warningCheckbox"><span class="legend warning"></span><svg class="icon"><use xlink:href="#warningIcon" /></svg>Warning<span class="count warning"></span></label></li>
                <li id="li-system"><label><input type="checkbox" checked="checked" id="systemCheckbox"><span class="legend system"></span><svg class="icon"><use xlink:href="#systemIcon" /></svg>System<span class="count system"></span></label></li>
                <li>
                    <label><input type="checkbox" checked="checked" id="logCheckbox"><span class="legend log"></span><svg class="icon"><use xlink:href="#logIcon" /></svg>Log<span class="count log"></span></label>
                    <ul>
                        <li id="li-ai"><label><input type="checkbox" checked="checked" id="aiCheckbox"><span class="legend ai"></span><svg class="icon"><use xlink:href="#aiIcon" /></svg>AI<span class="count ai"></span></label></li>
                        <li id="li-audio"><label><input type="checkbox" checked="checked" id="audioCheckbox"><span class="legend audio"></span><svg class="icon"><use xlink:href="#audioIcon" /></svg>Audio<span class="count audio"></span></label></li>
                        <li id="li-content"><label><input type="checkbox" checked="checked" id="contentCheckbox"><span class="legend content"></span><svg class="icon"><use xlink:href="#contentIcon" /></svg>Content<span class="count content"></span></label></li>
                        <li id="li-logic"><label><input type="checkbox" checked="checked" id="logicCheckbox"><span class="legend logic"></span><svg class="icon"><use xlink:href="#logicIcon" /></svg>Logic<span class="count logic"></span></label></li>
                        <li id="li-gui"><label><input type="checkbox" checked="checked" id="guiCheckbox"><span class="legend gui"></span><svg class="icon"><use xlink:href="#guiIcon" /></svg>GUI<span class="count gui"></span></label></li>
                        <li id="li-input"><label><input type="checkbox" checked="checked" id="inputCheckbox"><span class="legend input"></span><svg class="icon"><use xlink:href="#inputIcon" /></svg>Input<span class="count input"></span></label></li>
                        <li id="li-network"><label><input type="checkbox" checked="checked" id="networkCheckbox"><span class="legend network"></span><svg class="icon"><use xlink:href="#networkIcon" /></svg>Network<span class="count network"></span></label></li>
                        <li id="li-physics"><label><input type="checkbox" checked="checked" id="physicsCheckbox"><span class="legend physics"></span><svg class="icon"><use xlink:href="#physicsIcon" /></svg>Physics<span class="count physics"></span></label></li>
                    </ul>
                </li>
            </ul>
        </div>
        <div id="large" class="hidden">
            <p>There are large log types, they were unchecked for performance</p>
        </div>
        <div id="footer">
            <span class="repo">
                <a href="https://github.com/Sacred-Seed-Studio/Unity-File-Debug" target="_blank"><svg class="icon"><use xlink:href="#githubRepo" /></svg>Source</a>
            </span>
            <span class="issues">
                <a href="https://github.com/Sacred-Seed-Studio/Unity-File-Debug/issues" target="_blank"><svg class="icon"><use xlink:href="#githubIssue" /></svg>Issues</a>
            </span>
        </div>
    </div>

    <div id="mainPanel"></div>

    <script type="text/javascript">
        // Variables
            var mainPanel = document.getElementById('mainPanel');
            var searchBox = document.getElementById('search');
            var checkEvent = new CustomEvent('change', { checked: this.checked });
            var theSearchableElements = [];
            var maxToShowByDefault = 100;
            var largeFile = false;
            var title = document.getElementById('title');
            var startTime = document.getElementById('startTime');
            var endTime = document.getElementById('endTime');
            var largeNotice = document.getElementById('large');

            var counts = {
                assert: 0,
                error: 0,
                exception: 0,
                warning: 0,
                system: 0,
                log: 0,
                ai: 0,
                audio: 0,
                content: 0,
                logic: 0,
                gui: 0,
                input: 0,
                network: 0,
                physics: 0
            };

            var countElements = {
                assert: undefined,
                error: undefined,
                exception: undefined,
                warning: undefined,
                system: undefined,
                log: undefined,
                ai: undefined,
                audio: undefined,
                content: undefined,
                logic: undefined,
                gui: undefined,
                input: undefined,
                network: undefined,
                physics: undefined
            };

            var checklistElements = {
                assert: undefined,
                error: undefined,
                exception: undefined,
                warning: undefined,
                system: undefined,
                log: undefined,
                ai: undefined,
                audio: undefined,
                content: undefined,
                logic: undefined,
                gui: undefined,
                input: undefined,
                network: undefined,
                physics: undefined
            };

            var entryElements = {
                assert: [],
                error: [],
                exception: [],
                warning: [],
                system: [],
                log: [],
                ai: [],
                audio: [],
                content: [],
                logic: [],
                gui: [],
                input: [],
                network: [],
                physics: []
            };

            var checkboxElements = {
                all : document.getElementById('allCheckbox'),
                assert : document.getElementById('assertCheckbox'),
                error : document.getElementById('errorCheckbox'),
                exception : document.getElementById('exceptionCheckbox'),
                warning : document.getElementById('warningCheckbox'),
                system : document.getElementById('systemCheckbox'),
                log : document.getElementById('logCheckbox'),
                ai : document.getElementById('aiCheckbox'),
                audio : document.getElementById('audioCheckbox'),
                content : document.getElementById('contentCheckbox'),
                logic : document.getElementById('logicCheckbox'),
                gui : document.getElementById('guiCheckbox'),
                input : document.getElementById('inputCheckbox'),
                network : document.getElementById('networkCheckbox'),
                physics : document.getElementById('physicsCheckbox')
            };

        // Functions
            // Initialize page
                function init(){
                    console.time('init()');
                    // Get elements
                        // Get count elements
                            countElements["assert"] = document.getElementsByClassName("count assert")[0];
                            countElements["error"] = document.getElementsByClassName("count error")[0];
                            countElements["exception"] = document.getElementsByClassName("count exception")[0];
                            countElements["warning"] = document.getElementsByClassName("count warning")[0];
                            countElements["system"] = document.getElementsByClassName("count system")[0];
                            countElements["log"] = document.getElementsByClassName("count log")[0];
                            countElements["ai"] = document.getElementsByClassName("count ai")[0];
                            countElements["audio"] = document.getElementsByClassName("count audio")[0];
                            countElements["content"] = document.getElementsByClassName("count content")[0];
                            countElements["logic"] = document.getElementsByClassName("count logic")[0];
                            countElements["gui"] = document.getElementsByClassName("count gui")[0];
                            countElements["input"] = document.getElementsByClassName("count input")[0];
                            countElements["network"] = document.getElementsByClassName("count network")[0];
                            countElements["physics"] = document.getElementsByClassName("count physics")[0];
                        // Get checklist
                            checklistElements["assert"] = document.getElementById("li-assert");
                            checklistElements["error"] = document.getElementById("li-error");
                            checklistElements["exception"] = document.getElementById("li-exception");
                            checklistElements["warning"] = document.getElementById("li-warning");
                            checklistElements["system"] = document.getElementById("li-system");
                            checklistElements["log"] = document.getElementById("li-log");
                            checklistElements["ai"] = document.getElementById("li-ai");
                            checklistElements["audio"] = document.getElementById("li-audio");
                            checklistElements["content"] = document.getElementById("li-content");
                            checklistElements["logic"] = document.getElementById("li-logic");
                            checklistElements["gui"] = document.getElementById("li-gui");
                            checklistElements["input"] = document.getElementById("li-input");
                            checklistElements["network"] = document.getElementById("li-network");
                            checklistElements["physics"] = document.getElementById("li-physics");
                    console.time('init()');
                }//init

            // Load a file
                function handleFileSelect(evt) {
                    console.time("handleFileselect()");
                    var file = this.files[0];
                    title.textContent = file.name.substr(0, file.name.indexOf('.'));
                    var timesnip = file.name.replace(title.textContent + ".", '').substr(title.textContent.indexOf('.') + 1).replace('.json', '');
                    startTime.textContent = new Date(timesnip.substr(0, 10).replace(/\./g,'-')+"T"+timesnip.substr(11,2)+":"+timesnip.substr(14,2)+":"+timesnip.substr(17,2)).toLocaleString();
                    endTime.textContent = file.lastModifiedDate.toLocaleString();
                    if (file){
                        var reader = new FileReader();
                        reader.onload = function(f){
                            populateLogs(JSON.parse(f.target.result));
                            updateCounts();
                            updateEntriesList();
                            setCheckboxesOn();
                        }
                        reader.readAsText(file);
                    }
                    console.timeEnd("handleFileselect()");
                }//handleFileselect

                // Parse a file, clear existing logs, add new to document
                    function populateLogs(jsonFile){
                        console.time("populateLogs()");
                        mainPanel.innerHTML = "";
                        // Reset our counts
                        Object.keys(counts).forEach(function(k){
                            counts[k] = 0;
                        });
                        // Loop through each log entry and add some html
                        var entry, inner, time, type;
                        jsonFile.forEach(function(log){
                            type = log.t.toLowerCase();
                            counts[type] = ++counts[type];
                            entry = document.createElement('div');
                            entry.classList.add('entry', type);
                            entry.classList.add('hidden');
                            time = log.tm ? new Date(log.tm.substr(0, 10).replace(/\./g,'-')+"T"+log.tm.substr(11,2)+":"+log.tm.substr(14,2)+":"+log.tm.substr(17,2)).toLocaleString() : "";
                            inner = '<span class="timestamp">'+time+'</span>'+
                                    '<span class="message"><svg class="icon"><use xlink:href="#'+type+'Icon" /></svg><button class="stackBtn" onclick="openCloseStack(this)">Stack</button>'+log.l+'</span>'+
                                    '<span class="stack hidden">'+log.s.replace('\n', "<br>")+'</span>';
                            entry.innerHTML = inner;
                            mainPanel.appendChild(entry);
                        });
                        console.timeEnd("populateLogs()");
                    }//populateLogs
                
                // Update counts, hide empty lists
                    function updateCounts(){
                        console.time("updateCounts()");
                        
                        // Update counts
                            countElements["assert"].textContent = " (" + counts.assert + ")";
                            countElements["error"].textContent = " (" + counts.error + ")";
                            countElements["exception"].textContent = " (" + counts.exception + ")";
                            countElements["warning"].textContent = " (" + counts.warning + ")";
                            countElements["system"].textContent = " (" + counts.system + ")";
                            countElements["log"].textContent = " (" + counts.log + ")";
                            countElements["ai"].textContent = " (" + counts.ai + ")";
                            countElements["audio"].textContent = " (" + counts.audio + ")";
                            countElements["content"].textContent = " (" + counts.content + ")";
                            countElements["logic"].textContent = " (" + counts.logic + ")";
                            countElements["gui"].textContent = " (" + counts.gui + ")";
                            countElements["input"].textContent = " (" + counts.input + ")";
                            countElements["network"].textContent = " (" + counts.network + ")";
                            countElements["physics"].textContent = " (" + counts.physics + ")";

                        // Hide no counts
                            if (!counts["assert"]){ checklistElements["assert"].classList.add('hidden'); }
                            else { checklistElements["assert"].classList.remove('hidden'); }

                            if (!counts["error"]){ checklistElements["error"].classList.add('hidden'); }
                            else { checklistElements["error"].classList.remove('hidden'); }

                            if (!counts["exception"]){ checklistElements["exception"].classList.add('hidden'); }
                            else { checklistElements["exception"].classList.remove('hidden'); }

                            if (!counts["warning"]){ checklistElements["warning"].classList.add('hidden'); }
                            else { checklistElements["warning"].classList.remove('hidden'); }

                            if (!counts["system"]){ checklistElements["system"].classList.add('hidden'); }
                            else { checklistElements["system"].classList.remove('hidden'); }

                            if (!counts["ai"]){ checklistElements["ai"].classList.add('hidden'); }
                            else { checklistElements["ai"].classList.remove('hidden'); }
                            
                            if (!counts["audio"]){ checklistElements["audio"].classList.add('hidden'); }
                            else { checklistElements["audio"].classList.remove('hidden'); }

                            if (!counts["content"]){ checklistElements["content"].classList.add('hidden'); }
                            else { checklistElements["content"].classList.remove('hidden'); }

                            if (!counts["logic"]){ checklistElements["logic"].classList.add('hidden'); }
                            else { checklistElements["logic"].classList.remove('hidden'); }

                            if (!counts["gui"]){ checklistElements["gui"].classList.add('hidden'); }
                            else { checklistElements["gui"].classList.remove('hidden'); }

                            if (!counts["input"]){ checklistElements["input"].classList.add('hidden'); }
                            else { checklistElements["input"].classList.remove('hidden'); }

                            if (!counts["network"]){ checklistElements["network"].classList.add('hidden'); }
                            else { checklistElements["network"].classList.remove('hidden'); }

                            if (!counts["physics"]){ checklistElements["physics"].classList.add('hidden'); }
                            else { checklistElements["physics"].classList.remove('hidden'); }
                        
                        console.timeEnd("updateCounts()");
                    }//updateCounts

                // Update list entries
                    function updateEntriesList(){
                        console.time("updateEntriesList()");
                        entryElements["assert"] = document.getElementsByClassName("entry assert");
                        entryElements["error"] = document.getElementsByClassName("entry error");
                        entryElements["exception"] = document.getElementsByClassName("entry exception");
                        entryElements["warning"] = document.getElementsByClassName("entry warning");
                        entryElements["system"] = document.getElementsByClassName("entry system");
                        entryElements["log"] = document.getElementsByClassName("entry log");
                        entryElements["ai"] = document.getElementsByClassName("entry ai");
                        entryElements["audio"] = document.getElementsByClassName("entry audio");
                        entryElements["content"] = document.getElementsByClassName("entry content");
                        entryElements["logic"] = document.getElementsByClassName("entry logic");
                        entryElements["gui"] = document.getElementsByClassName("entry gui");
                        entryElements["input"] = document.getElementsByClassName("entry input");
                        entryElements["network"] = document.getElementsByClassName("entry network");
                        entryElements["physics"] = document.getElementsByClassName("entry physics");
                        console.timeEnd("updateEntriesList()");
                    }//updateEntriesList

                // turn off big lists
                    function setCheckboxesOn(){
                        var any = false, log = false;
                        Object.keys(counts).forEach(function(key){
                            if (counts[key] > maxToShowByDefault){
                                any = true;
                                if (key === "log"){
                                    log = true;
                                }
                                checkboxElements[key].checked = false;
                                if (!(log && (key === "ai" || key === "audio" || key === "content" || key === "logic" || key === "gui" || key === "input" || key === "network" || key === "physics"))){
                                    checkboxElements[key].dispatchEvent(checkEvent);
                                } 
                            }
                            else { 
                                checkboxElements[key].checked = true;
                                checkboxElements[key].dispatchEvent(checkEvent);
                            }
                        });
                        if (any){
                            checkboxElements["all"].checked = false;
                            largeNotice.classList.remove('hidden');
                            // checkboxElements["all"].dispatchEvent(checkEvent);
                        }
                        else if (log){ 
                            checkboxElements["log"].dispatchEvent(checkEvent); 
                            largeNotice.classList.remove('hidden');
                        }
                        else {
                            checkboxElements["all"].checked = true;
                            checkboxElements["all"].dispatchEvent(checkEvent);
                            largeNotice.classList.add('hidden');
                        }
                    }//setCheckboxesOn

            // Helper attached to buttons to open/close stack for current entry
                function openCloseStack(element){
                    console.time("openCloseStack()");
                    var stack = element.parentElement.parentElement.getElementsByClassName('stack');
                    stack[0].classList.toggle('hidden');
                    console.timeEnd("openCloseStack()");
                }//openCloseStack

            // Helper to show/hide the log entry from checkbox. If a search is present rerun it
                function showOrHideLogEntry(type, checked){
                    console.time("showOrHideLogEntry("+type+")");
                    for (var i=0; i<entryElements[type].length; i++){
                        if (checked) { 
                            entryElements[type][i].classList.remove("hidden");
                            theSearchableElements.push(entryElements[type][i]); 
                        }
                        else { 
                            entryElements[type][i].classList.add("hidden");
                            var index = theSearchableElements.indexOf(entryElements[type][i]);
                            theSearchableElements.splice(index, 1);
                        }
                    }
                    // If there is a search query rerun it
                    if (searchBox.value){
                        var event = new CustomEvent('input', {});
                        searchBox.dispatchEvent(event);
                    }
                    console.timeEnd("showOrHideLogEntry("+type+")");
                }//showOrHideLogEntry

            // Helper to handle search query
                function search(evt){
                    console.time('search()');
                    var searchQuery = this.value.toLowerCase();
                    var messages, stack, type, time, inMessage, inStack, inType, inTime;
                    theSearchableElements.forEach(function(element){
                        // Reset
                            inType = false; 
                            inTime = false;
                            type = element.classList.toString().replace("entry","").replace("hidden","").replace(" ","");
                            time = element.getElementsByClassName('timestamp')[0].textContent.toLowerCase();
                            if (time.indexOf(searchQuery) > -1){ inTime = true; }
                            if (type.indexOf(searchQuery) > -1){ inType = true; }
                        // Loop if not already a match
                            if (!inType && !inTime){
                                inMessage = false; 
                                inStack = false;
                                messages = element.getElementsByClassName('message');
                                stack = element.getElementsByClassName('stack');
                                // Loop through messages
                                    for (var j=0; j<messages.length; j++){
                                        if (messages[j].nodeType == 1){
                                            if (messages[j].textContent.toLowerCase().indexOf(searchQuery) > -1){ inMessage = true; }
                                        }
                                    }//for each message
                                // Loop through stack
                                    for (var j=0; j<stack.length; j++){
                                        if (stack[j].nodeType == 1){
                                            if (stack[j].textContent.toLowerCase().indexOf(searchQuery) > -1){ inStack = true; }
                                        }
                                    }//for each stack 
                            }
                        // Add remove classes if found
                            if (inMessage || inStack || inType || inTime){ element.classList.remove("hidden"); }
                            else { element.classList.add("hidden"); }
                    });// for each theSearchableElements
                    console.timeEnd('search()');
                }//search

        // DOM Content Loaded
            document.addEventListener('DOMContentLoaded', function(){
                console.time("DOMContentLoaded");
                var event = new CustomEvent('change', { checked: this.checked });
                allCheckbox.dispatchEvent(event);
                init();
                console.timeEnd("DOMContentLoaded");
            }, false); //DOMContentLoaded

        // Listeners
            // File loading
                document.getElementById('file').addEventListener('change', handleFileSelect, false);

            // Search logic
                searchBox.addEventListener('input', search, false);

            // Listener for the select all checkbox
                allCheckbox.addEventListener('change', function(e){
                    assertCheckbox.checked = (this.checked ? true : false);
                    errorCheckbox.checked = (this.checked ? true : false);
                    exceptionCheckbox.checked = (this.checked ? true : false);
                    warningCheckbox.checked = (this.checked ? true : false);
                    systemCheckbox.checked = (this.checked ? true : false);
                    logCheckbox.checked = (this.checked ? true : false);

                    var event = new CustomEvent('change', { checked: this.checked });
                    assertCheckbox.dispatchEvent(event);
                    errorCheckbox.dispatchEvent(event);
                    exceptionCheckbox.dispatchEvent(event);
                    warningCheckbox.dispatchEvent(event);
                    systemCheckbox.dispatchEvent(event);
                    logCheckbox.dispatchEvent(event);
                });//allCheckbox change

            // Listener for the log checkbox
                logCheckbox.addEventListener('change', function(e){

                    showOrHideLogEntry("log", this.checked);

                    aiCheckbox.checked = (this.checked ? true : false);
                    audioCheckbox.checked = (this.checked ? true : false);
                    contentCheckbox.checked = (this.checked ? true : false);
                    logicCheckbox.checked = (this.checked ? true : false);
                    guiCheckbox.checked = (this.checked ? true : false);
                    inputCheckbox.checked = (this.checked ? true : false);
                    networkCheckbox.checked = (this.checked ? true : false);
                    physicsCheckbox.checked = (this.checked ? true : false);

                    var event = new CustomEvent('change', { checked: this.checked });
                    aiCheckbox.dispatchEvent(event);
                    audioCheckbox.dispatchEvent(event);
                    contentCheckbox.dispatchEvent(event);
                    logicCheckbox.dispatchEvent(event);
                    guiCheckbox.dispatchEvent(event);
                    inputCheckbox.dispatchEvent(event);
                    networkCheckbox.dispatchEvent(event);
                    physicsCheckbox.dispatchEvent(event);       
                });//logCheckbox change

            // Listeners for individual checkboxes
                assertCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("assert", e.checked); }
                    else { showOrHideLogEntry("assert", this.checked); }
                });

                errorCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("error", e.checked); }
                    else { showOrHideLogEntry("error", this.checked); }
                });

                exceptionCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("exception", e.checked); }
                    else { showOrHideLogEntry("exception", this.checked); }
                });

                warningCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("warning", e.checked); }
                    else { showOrHideLogEntry("warning", this.checked); }
                });

                systemCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("system", e.checked); }
                    else { showOrHideLogEntry("system", this.checked); }
                });

                aiCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("ai", e.checked); }
                    else { showOrHideLogEntry("ai", this.checked); }
                });

                audioCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("audio", e.checked); }
                    else { showOrHideLogEntry("audio", this.checked); }
                });

                contentCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("content", e.checked); }
                    else { showOrHideLogEntry("content", this.checked); }
                });

                logicCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("logic", e.checked); }
                    else { showOrHideLogEntry("logic", this.checked); }
                });

                guiCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("gui", e.checked); }
                    else { showOrHideLogEntry("gui", this.checked); }
                });

                inputCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("input", e.checked); }
                    else { showOrHideLogEntry("input", this.checked); }
                });

                networkCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("network", e.checked); }
                    else { showOrHideLogEntry("network", this.checked); }
                });

                physicsCheckbox.addEventListener('change', function(e){
                    if (e.checked) { showOrHideLogEntry("physics", e.checked); }
                    else { showOrHideLogEntry("physics", this.checked); }
                });
    </script>
</body>
</html>